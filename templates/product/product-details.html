{% extends 'base.html' %}
{% load static %}


{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>

    .range-value {

        position: absolute;
        position: relative;
        text-align: center;
        top: -50px;
        width: 50px;
        background-color: #007BFF;
        color: white;
        font-size: 14px;
        border-radius: 5px;
    }

    input[type="range"] {
        width: 100%;
    }

    .quantity-box {
    display: flex;
    }

    .quantity-box button {
    display: inline-block;
    width: 25%;
    color: #333333;
    background-color: #f1f1f1;
    border: 1px solid #e4e4e4;
    text-align: center;
    padding: 5px;
    font-weight: bold;
    line-height: 1;
    cursor: pointer;
    }

    .quantity-box input[type="number"] {
    display: inline-block;
    width: 50%;
    text-align: center;
    border: 1px solid #e4e4e4;
    border-left: 0;
    border-right: 0;
    }

    .quantity-box input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    }

    .quantity-box button {
        width: 33px;
        line-height: 21px;
    }

    .red-color {
            color: #f90202 !important;
            transition: color 0.5s ease;
        }

    #valabasa {
        font-size: 50px;
    }

    .cart-message {
        position: fixed;
        z-index: 100;
        display: none;
        top: 77px;
        right: -100%;
        padding: 10px 20px;
        background-color: blanchedalmond;
        border-radius: 45px;
        animation: slideInRight 0.5s ease-in-out forwards, moveBackRight 0.5s ease-in-out 3s forwards;
    }

    @keyframes slideInRight {
        from {
            right: -100%;
        }
        to {
            right: 15px;
        }
    }

    @keyframes moveBackRight {
        from {
            right: 15px;
        }
        to {
            right: -100%;
        }
    }


</style>
    <!--============= Hero Section Starts Here =============-->
    <div class="hero-section style-2">
        <div class="container">
            <ul class="breadcrumb">
                <li>
                    <a href="index.html">Home</a>
                </li>
                <li>
                    <a href="#0">Pages</a>
                </li>
                <li>
                    <span>Vehicles</span>
                </li>
            </ul>
        </div>
        <div class="bg_img hero-bg bottom_center" data-background="{% static 'assets/images/banner/hero-bg.png' %} "></div>
    </div>
    <!--============= Hero Section Ends Here =============-->

    <div>
        <h4 id="cart_mgs" class="cart-message">Add To Cart</h4>
    </div>
    <!--============= Product Details Section Starts Here =============-->
    <section class="product-details padding-bottom mt--240 mt-lg--440">
        <div class="container">
            <div class="product-details-slider-top-wrapper">
                <div class="product-details-slider owl-theme owl-carousel" id="sync1" style="text-align: -webkit-center;">
                    {% for product in product_img %}
                    <div class="slide-top-item" style="height: 700px; width: 800px;">
                        <div class="slide-inner" >
                            <img src="{{ product.url  }}" alt="product">
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="product-details-slider-wrapper">
                <div class="product-bottom-slider owl-theme owl-carousel" id="sync2">
                    {% for product in product_img %}
                    <div class="slide-bottom-item" style="height: 150px; width: 150px;">
                        <div class="slide-inner" >
                            <img src="{{ product.url  }}" alt="product">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <span class="det-prev det-nav">
                    <i class="fas fa-angle-left"></i>
                </span>
                <span class="det-next det-nav active">
                    <i class="fas fa-angle-right"></i>
                </span>
            </div>
            <div class="row mt-40-60-80">
                <div class="col-lg-8">
                    <div class="product-details-content">
                        <div class="product-details-header">
                            <h2 class="title">{{ product_detail.title }}</h2>
                            <ul>
                                <li>Item #: {{ product_detail.product_code }}</li>
                            </ul>
                        </div>
                        <ul class="price-table mb-30">
                            <li class="header">
                                <h5 class="current">Current Price</h5>
                                <h3 class="price" id="price">RS {{ product_detail.current_bid_amount }}</h3>
                            </li>
                            <!-- <li>
                                <span class="details">Buyer's Premium</span>
                                <h5 class="info">10.00%</h5>
                            </li> -->
                            <li>
                                <span class="details">Bid Increment (RS)</span>
                                <h5 class="info" id="bid_increment">RS 0.00</h5>
                            </li>
                        </ul>
                        <div class="product-bid-area">
                            <form class="product-bid-form" method = "post">
                                {% csrf_token %} 
                                <div class="search-icon">
                                    <img src="{% static 'assets/images/product/search-icon.png' %}" alt="product">
                                </div>
                                <!-- <input type="range" name="bid_ammount" id="range">
                                <div class="range-value" id="rangeValue"></div> -->

                                <div class="person-quantity">
                                    <div class="quantity-box" style="padding: 0px 20px 0px 20px;">
                                        <button type="button" class="sub rating custom-button  border" style="padding: 0px 30px 0px 30px;">-</button>
                                        <input type="number" required="" class="num" value="0" name="bid_ammount" id="rangeValue" style="padding: 0px 100px 0px 100px;">
                                        <button type="button" class="add rating custom-button  border" style="padding: 0px 30px 0px 30px;">+</button>
                                    </div>
                                </div>
                                <button type="submit"  name="exit" class="rating custom-button  border">exit from bid</button>
                                {% if product_detail.exits == False %}
                                    <button type="submit"  name="submit_bid" id="submit_bid" class="rating custom-button  border">Submit a bid</button>
                                {% endif %}
                                
                            </form>
                        </div>
                        <div class="buy-now-area">
                            <a href="#0" class="final_price rating custom-button border" id="final_price">Add To Card: {{ product_detail.final_price }}</a>

                            <i id="valabasa" class="fa-sharp fa-solid fa-heart btn btn-light border px-2 icon-hover-primary" title="Add To Favorite" style="color: rgb(179, 177, 177); margin-left: 400px;"></i>
                            <div class="share-area" >
                                <span>Share to:</span>
                                <ul>
                                    <li>
                                        <a href="#0"><i class="fab fa-facebook-f"></i></a>
                                    </li>
                                    <li>
                                        <a href="#0"><i class="fab fa-twitter"></i></a>
                                    </li>
                                    <li>
                                        <a href="#0"><i class="fab fa-linkedin-in"></i></a>
                                    </li>
                                    <li>
                                        <a href="#0"><i class="fab fa-instagram"></i></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="product-sidebar-area">
                        <div class="product-single-sidebar mb-3">
                            <h6 class="title">This Auction Ends in:</h6>
                            <div class="countdown">
                                <div id="bid_counter_1"></div>
                              </div>
                            <div class="side-counter-area">
                                <div class="side-counter-item">
                                    <div class="thumb">
                                        <img src="{% static 'assets/images/product/icon1.png' %}" alt="product">
                                    </div>
                                    <div class="content">
                                        <h3 class="count-title"><span class="counter" id="active-bidders">{{ product_detail.active_bidders }}</span></h3>
                                        <p>Active Bidders</p>
                                    </div>
                                </div>
                                <div class="side-counter-item">
                                    <div class="thumb">
                                        <img src="{% static 'assets/images/product/icon3.png' %}" alt="product">
                                    </div>
                                    
                                        <div class="content">
                                            <h6 class="count-title"><span  id="last-bidder">{{user_name}}</span></h6>
                                            <p >Last Bidder</p>
                                        </div>
                                   
                                    
                                </div>
                                <div class="side-counter-item">
                                    <div class="thumb">
                                        <img src="{% static 'assets/images/product/icon2.png' %}" alt="product">
                                    </div>
                                    <div class="content">
                                        <h3 class="count-title"><span  id="visit-count"></span></h3>
                                        <p >Current Watching</p>
                                    </div>
                                </div>
                                <div class="side-counter-item">
                                    <div class="thumb">
                                        <img src="{% static 'assets/images/product/icon3.png' %}" alt="product">
                                    </div>
                                    <div class="content">
                                        <h3 class="count-title"><span class="counter" id="total_bids">{{ product_detail.total_bids }}</span></h3>
                                        <p>Total Bids</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="#0" class="cart-link">View Shipping, Payment & Auction Policies</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="product-tab-menu-area mb-40-60 mt-70-100">
            <div class="container">
                <ul class="product-tab-menu nav nav-tabs">
                    <li>
                        <a href="#details" class="active" data-toggle="tab">
                            <div class="thumb">
                                <img src="{% static 'assets/images/product/tab1.png' %}" alt="product">
                            </div>
                            <div class="content">Description</div>
                        </a>
                    </li>
                    <li>
                        <a href="#delevery" data-toggle="tab">
                            <div class="thumb">
                                <img src="{% static 'assets/images/product/tab2.png' %}" alt="product">
                            </div>
                            <div class="content">Delivery Options</div>
                        </a>
                    </li>
                    <li>
                        <a href="#history" data-toggle="tab">
                            <div class="thumb">
                                <img src="{% static 'assets/images/product/tab3.png' %}" alt="product">
                            </div>
                            <div class="content">Bid History (36)</div>
                        </a>
                    </li>
                    <li>
                        <a href="#questions" data-toggle="tab">
                            <div class="thumb">
                                <img src="{% static 'assets/images/product/tab4.png' %}" alt="product">
                            </div>
                            <div class="content">Questions </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="container">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="details">
                    <div class="tab-details-content">
                        <div class="header-area">
                            <h3 class="title">2012 Ford Escape Hybrid (Brooklyn, NY 11214)</h3>
                            <div class="item">
                                <table class="product-info-table">
                                    <tbody>
                                        <tr>
                                            <th>Condition</th>
                                            <td>New</td>
                                        </tr>
                                        <tr>
                                            <th>Mileage</th>
                                            <td>15,000 miles</td>
                                        </tr>
                                        <tr>
                                            <th>Year</th>
                                            <td>09-2017</td>
                                        </tr>
                                        <tr>
                                            <th>Engine</th>
                                            <td>I-4 1,5 l</td>
                                        </tr>
                                        <tr>
                                            <th>Fuel</th>
                                            <td>Regular</td>
                                        </tr>
                                        <tr>
                                            <th>Transmission</th>
                                            <td>Automatic</td>
                                        </tr>
                                        <tr>
                                            <th>Color</th>
                                            <td>Blue</td>
                                        </tr>
                                        <tr>
                                            <th>Doors</th>
                                            <td>5</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">NYC Fleet / DCAS units may be located at either of two locations:
                                </h5>
                                <ul>
                                    <li>Brooklyn, NY (1908 Shore Parkway)</li>
                                    <li>Medford, NY (66 Peconic Ave)</li>
                                </ul>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">This unit is located at:</h5>
                                <ul>
                                    <li>Kenben Industries Ltd.</li>
                                    <li>1908 Shore Parkway</li>
                                    <li>Brooklyn, NY 11214</li>
                                </ul>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">Acceptance of condition - buyer inspection/preview</h5>
                                <p>Vehicles and equipment often display significant wear and tear. Assets are sold AS IS
                                    with no warranty, express or implied, and we highly recommend previewing them before
                                    bidding. The preview period is the only opportunity to inspect an asset to verify
                                    condition and suitability. No refunds, adjustments or returns will be entertained.
                                </p>
                                <p>Vehicle preview inspections of the vehicle can be done at the below location on
                                    Monday and Tuesday from 10am - 2pm. See Preview Rules Here.</p>
                                <ul>
                                    <li>Kenben Industries Ltd.</li>
                                    <li>1908 Shore Parkway</li>
                                    <li>Brooklyn, NY 11214</li>
                                </ul>
                                <p>BUYER is responsible for all storage fees at time of pick-up. See above under
                                    IMPORTANT PICK-UP TIMES for specific requirements for this asset, but generally
                                    assets must be picked up within 2 business days of payment otherwise additional
                                    storage fees will be applied.</p>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">Legal Notice</h5>
                                <p>Vehicles may not be driven off the lot except with a dealer plate affixed. By law,
                                    vehicles are not permitted to be parked on or to drive on the streets of New York
                                    without registration and plates registered to the vehicle. If the buyer cannot
                                    obtain the required registration and plates prior to pick up, they should have the
                                    vehicle towed at their own expense. The buyer should have the vehicle towed at their
                                    own expense.</p>
                                <p>Condition: Untested - Sold As-Is</p>
                                <p>Employees of Sbidu, its subcontractors and affiliated companies, employees of the NYC
                                    Government and those bidding on behalf of PropertyRoom.com, its subcontractors and
                                    affiliated companies and employees of the NYC Government are not permitted to bid on
                                    or purchase NYC Fleet/DCAS assets. </p>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">Condition</h5>
                                <p>This ASSET is being listed on behalf of a law enforcement agency or other partner
                                    ("SELLER") by PropertyRoom.com on a Sold AS IS, WHERE IS, WITH ALL FAULTS basis,
                                    with no representation or warranty from PropertyRoom.com or SELLER. In many cases,
                                    the car, boat, truck, motorcycle, aircraft, mowers/tractors, etc. ("ASSET") sold on
                                    PropertyRoom.com comes from seizure or forfeiture, and the SELLER typically does not
                                    possess use-based knowledge of the ASSET. Further, PropertyRoom.com does not
                                    physically inspect the ASSET and cannot attest to actual working conditions.
                                    PropertyRoom.com and SELLER gather information about the ASSET from authoritative
                                    sources; still, errors may appear from time to time in the listing. PropertyRoom.com
                                    cautions any website user, shopper, bidder, etc. ("BUYER") to attempt to confirm,
                                    with us, information material to a bidding/purchasing decision.</p>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">Bidding</h5>
                                <p>At this time Sbidu only accepts bidders from the United States, Canada and Mexico on
                                    Vehicles and Heavy Industrial Equipment. The Bid Now button will appear on auctions
                                    where you are qualified to place a bid.</p>
                            </div>
                            <div class="item">
                                <h5 class="subtitle">Buyer Responsibility</h5>
                                <p>The BUYER will receive an email notification from PropertyRoom.com following the
                                    close of an auction. After fraud verification and payment settlement, we will email
                                    the BUYER instructions for retrieving the ASSET from the Will-Call Location listed
                                    above.</p>
                                <p>All applicable shipping, logistics, transportation, customs, fees, taxes,
                                    export/import activities and all associated costs are the sole responsibility of the
                                    BUYER. No shipping, customs, export or import assistance is available from Sbidu.
                                </p>
                                <p>When applicable for a given ASSET, BUYER bears responsibility for determining motor
                                    vehicle registration requirements in the applicable jurisdiction as well as costs,
                                    including any fees, registration fees, taxes, etc., owed as a result of BUYER
                                    registering an ASSET; for example, BUYER bears sole responsibility for all
                                    title/registration/smog and other such fees.</p>
                                <p>BUYER is responsible for all storage fees at time of pick-up. See above under
                                    IMPORTANT PICK-UP TIMES for specific requirements for this asset, but generally
                                    assets must be picked up within 2 business days of payment otherwise additional
                                    storage fees will be applied.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade show" id="delevery">
                    <div class="shipping-wrapper">
                        <div class="item">
                            <h5 class="title">shipping</h5>
                            <div class="table-wrapper">
                                <table class="shipping-table">
                                    <thead>
                                        <tr>
                                            <th>Available delivery methods </th>
                                            <th>Price</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Customer Pick-up (within 10 days)</td>
                                            <td>0.00</td>
                                        </tr>
                                        <tr>
                                            <td>Standard Shipping (5-7 business days)</td>
                                            <td>Not Applicable</td>
                                        </tr>
                                        <tr>
                                            <td>Expedited Shipping (2-4 business days)</td>
                                            <td>Not Applicable</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="item">
                            <h5 class="title">Notes</h5>
                            <p>Please carefully review our shipping and returns policy before committing to a bid.
                                From time to time, and at its sole discretion, Sbidu may change the prevailing fee
                                structure for shipping and handling.</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade show" id="history">
                    <div class="history-wrapper">
                        <div class="item">
                            <h5 class="title">Bid History</h5>
                            <div class="history-table-area">
                                <table class="history-table">
                                    <thead>
                                        <tr>
                                            <th>Bidder</th>
                                            <th>date</th>
                                            <th>time</th>
                                            <th>unit price</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td data-history="bidder">
                                                <div class="user-info">
                                                    <div class="thumb">
                                                        <img src="assets/images/history/01.png" alt="history">
                                                    </div>
                                                    <div class="content">
                                                        Moses Watts
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-history="date">06/16/2021</td>
                                            <td data-history="time">02:45:25 PM</td>
                                            <td data-history="unit price">900.00</td>
                                        </tr>
                                        <tr>
                                            <td data-history="bidder">
                                                <div class="user-info">
                                                    <div class="thumb">
                                                        <img src="assets/images/history/02.png" alt="history">
                                                    </div>
                                                    <div class="content">
                                                        Pat Powell
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-history="date">06/16/2021</td>
                                            <td data-history="time">02:45:25 PM</td>
                                            <td data-history="unit price">900.00</td>
                                        </tr>
                                        <tr>
                                            <td data-history="bidder">
                                                <div class="user-info">
                                                    <div class="thumb">
                                                        <img src="assets/images/history/03.png" alt="history">
                                                    </div>
                                                    <div class="content">
                                                        Jack Rodgers
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-history="date">06/16/2021</td>
                                            <td data-history="time">02:45:25 PM</td>
                                            <td data-history="unit price">900.00</td>
                                        </tr>
                                        <tr>
                                            <td data-history="bidder">
                                                <div class="user-info">
                                                    <div class="thumb">
                                                        <img src="assets/images/history/04.png" alt="history">
                                                    </div>
                                                    <div class="content">
                                                        Arlene Paul
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-history="date">06/16/2021</td>
                                            <td data-history="time">02:45:25 PM</td>
                                            <td data-history="unit price">900.00</td>
                                        </tr>
                                        <tr>
                                            <td data-history="bidder">
                                                <div class="user-info">
                                                    <div class="thumb">
                                                        <img src="assets/images/history/05.png" alt="history">
                                                    </div>
                                                    <div class="content">
                                                        Marcia Clarke
                                                    </div>
                                                </div>
                                            </td>
                                            <td data-history="date">06/16/2021</td>
                                            <td data-history="time">02:45:25 PM</td>
                                            <td data-history="unit price">900.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="text-center mb-3 mt-4">
                                    <a href="#0" class="button-3">Load More</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade show" id="questions">
                    <h5 class="faq-head-title">Frequently Asked Questions</h5>
                    <div class="faq-wrapper">
                        <div class="faq-item">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">How to start
                                    bidding?</span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">Security Deposit /
                                    Bidding Power </span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">Delivery time to the
                                    destination port </span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">How to register to bid
                                    in an auction?</span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                        <div class="faq-item open active">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">How will I know if my
                                    bid was successful?</span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                        <div class="faq-item">
                            <div class="faq-title">
                                <img src="assets/css/img/faq.png" alt="css"><span class="title">What happens if I bid on
                                    the wrong lot?</span><span class="right-icon"></span>
                            </div>
                            <div class="faq-content">
                                <p>All successful bidders can confirm their winning bid by checking the “Sbidu”. In
                                    addition, all successful bidders will receive an email notifying them of their
                                    winning bid after the auction closes.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
    <!--============= Product Details Section Ends Here =============-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var slug = '{{ product_detail.slug }}';
        $.ajax({
            method: 'GET',
            url: `/watchlist/${slug}/`,
            success: function (data) {
                console.log(data,"-----------");
                if (data['product'].includes(slug)){
                    const heartIcon = document.getElementById("valabasa");
                    heartIcon.classList.toggle("red-color");
                }
            },
        }); 


        document.addEventListener("DOMContentLoaded", function () {
            const heartIcon = document.getElementById("valabasa");
            heartIcon.addEventListener("click", function () {
                heartIcon.classList.toggle("red-color");
            });
        });

    
        $('#valabasa').click(function() {
            if ($(this).hasClass('red-color')) {
                $.ajax({
                    method: 'POST',
                    data: {
                        'key': 'remove_select',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    url: `/watchlist/${slug}/`,
                    success: function (data) {
                        console.log(data);     
                    },
                }); 
            } else {
                $.ajax({
                    type: "POST",
                    data: {
                        'key': 'select',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    url: `/watchlist/${slug}/`,
                    success: function (data) {
                        console.log(data);     
                    },
                    error: function (xhr, exception, thrownError) {
                        var msg = "";
                        if (xhr.status === 0) {
                            msg = "Not connect.\n Verify Network.";
                        } else if (xhr.status == 404) {
                            msg = "Requested page not found. [404]";
                        } else if (xhr.status == 500) {
                            msg = "Internal Server Error [500].";
                        } else if (exception === "parsererror") {
                            msg = "Requested JSON parse failed.";
                        } else if (exception === "timeout") {
                            msg = "Time out error.";
                        } else if (exception === "abort") {
                            msg = "Ajax request aborted.";
                        } else {
                            msg = "Error:" + xhr.status + " " + xhr.responseText;
                        }
                        if (callbackError) {
                            callbackError(msg);
                        }
                    
                    }
                }); 
            }
        });
    </script>


    <script>
        const product_detail = new Date('{{ product_detail |escapejs }}'); 
        const countdownElement = document.querySelector("#bid_counter_1");
        const startDate = new Date('{{ bid_end |escapejs }}'); // Set your start date and time
        const endDate = new Date('{{ product_detail.bid_end_time |escapejs }}');   // Set your end date and time
        console.log(startDate); 
        console.log(endDate);
        const currentDate = new Date();
    
        if (startDate > currentDate) {
            // Auction hasn't started yet
            countdownElement.textContent = 'Coming Soon';
        } else if (endDate < currentDate) {
            // Auction has ended
            countdownElement.textContent = 'Expired';
        } else {
            // Auction is ongoing, create and update countdown
            const interval = setInterval(updateCountdown, 1000);
            function updateCountdown() {
                const remainingTime = endDate - new Date();
    
                if (remainingTime <= 0) {
                    clearInterval(interval);
                    countdownElement.textContent = 'Expired';
                } else {
                    const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
    
                    countdownElement.textContent = `${days}d : ${hours}h : ${minutes}m : ${seconds}s`;
                }
            }
            updateCountdown(); 
        }

        

        const addButton = document.querySelector(".add");
        const subButton = document.querySelector(".sub");
        const inputField = document.querySelector(".num");

        // Get the current price data and parse it as an integer
        const priceData = document.getElementById('price').innerHTML;
        const final_price = document.getElementById("final_price").innerHTML;
        const parts = priceData.split(" ");



        // Get the minimum and maximum values
        const max = parseInt(final_price.split(" ")[3]);

        const min = parseInt(parts[1])+100;
        console.log(max,min);

        // Initialize the input field value
        inputField.value = parseInt(min) + 100;

        // Add event listener for the plus button
        addButton.addEventListener("click", function () {
            // Increment by 500, but don't exceed the maximum
            let newValue = parseInt(inputField.value) + 500;
            if (newValue > max) {
                newValue = max;
            }
            inputField.value = newValue;
        });

        var slug = '{{ product_detail.slug }}';
        console.log(slug);
        $.ajax({
            method: 'GET',
            url: `/add_cart/${slug}/`,
            success: function (data) {
                try{
                    if (data['products'].includes(slug)){
                        console.log(data,"-----------");
                        const final_price = document.getElementById("final_price")
                        final_price.innerHTML = "Go To Cart"
                        final_price.href= "{% url 'my_cart' %}"
                        final_price.id="";
                        
                    }
                    else{
                        $('#final_price').click(function() {
                        const final_price = document.getElementById("final_price")
                        $("#cart_mgs").show().delay(3000).fadeOut();
                        final_price.innerHTML = "Go To Cart";
                        final_price.id="";
                        $.ajax({
                                type: "POST",
                                data: {
                                    'key': 'add_cart',
                                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                                },
                                url: `/add_cart/${slug}/`,
                                success: function (data) {
                                    console.log(data);     
                                },
                            });
                        });
                        final_price.href= "{% url 'my_cart' %}"
                    }}
                catch{
                    $('#final_price').click(function() {
                    const final_price = document.getElementById("final_price")
                    $("#cart_mgs").show().delay(3000).fadeOut();
                    final_price.innerHTML = "Go To Cart";
                    final_price.id="";
                    $.ajax({
                            type: "POST",
                            data: {
                                'key': 'add_cart',
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                            },
                            url: `/add_cart/${slug}/`,
                            success: function (data) {
                                console.log(data);     
                            },
                        });
                    });
                    final_price.href= "{% url 'my_cart' %}"
                }
            },
        }); 

        // Add event listener for the minus button
        subButton.addEventListener("click", function () {
            // Decrement by 500, but don't go below the minimum
            let newValue = parseInt(inputField.value) - 500;
            if (newValue < min) {
                newValue = min;
            }
            inputField.value = newValue;
        });


        
    
    </script>

    <script>
        const roomName = '{{ product_detail.slug }}';
        console.log(roomName);

        const user_count_socket = new WebSocket(
            'ws://' + window.location.host +
            '/ws/online_users/' + roomName + '/');

        console.log(user_count_socket)

        user_count_socket.onopen = function(event) {
            console.log("WebSocket connection opened.");
        };

        user_count_socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            document.getElementById('visit-count').innerHTML = data;
        };

        // Handle WebSocket errors
        user_count_socket.onerror = function(event) {
            console.error('WebSocket error:', event);
        };

        //////////////////////////////////////////////////
        const submit_bid = document.getElementById("submit_bid");
        const amount = document.getElementById('rangeValue')

        const update_bid_socket = new WebSocket(
            'ws://' + window.location.host +'/ws/update_bid/' + roomName +'/');

        console.log(update_bid_socket)

        update_bid_socket.onopen = function(event) {
            console.log("update_bid_socket WebSocket connection opened.");
        };

        submit_bid.addEventListener("click", () => send_mgs())

        function send_mgs(){
            const amount = document.getElementById('rangeValue').value
            const user = "{{ user }}";
            console.log(user,"---------------");

            update_bid_socket.send(
                JSON.stringify(
                    {"price": amount,
                    'username': user
                    })
            )
        }

        update_bid_socket.onmessage = function(event){
            const data = JSON.parse(event.data);

            $("#price").text("RS "+ data.price );
            $("#bid_increment").text("RS "+ data.last_bid_increment );
            document.getElementById("total_bids").innerHTML =data.total_bids
            document.getElementById("active-bidders").innerHTML = data.active_bidders
            amount.value = parseInt(data.price) +100

            document.getElementById("last-bidder").innerHTML = data.last_bidder


            // var user = "{{ user }}";
            // var name = `${user.first_name} {user.last_name}` 
            // console.log(name);
            // if (name == data.last_bidder){
            //     document.getElementById("last-bidder").innerHTML = `$(you)`
            // }
            // else{
            //     document.getElementById("last-bidder").innerHTML = `${name}`
            // }


        }
        </script>
    {% endblock content %}